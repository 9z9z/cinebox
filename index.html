<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>مكتبة الأفلام والمسلسلات والأنمي - شرير ومطيع</title>
<style>
  body {
    font-family: "Tahoma", sans-serif;
    background: #111;
    color: #eee;
    margin: 0; padding: 0;
  }
  header {
    background: #222;
    padding: 10px;
    position: sticky;
    top: 0;
    z-index: 20;
  }
  .slider {
    display: flex;
    overflow-x: auto;
    scroll-behavior: smooth;
    gap: 10px;
    padding-bottom: 5px;
  }
  .slider::-webkit-scrollbar {
    display: none;
  }
  .slide-item {
    min-width: 180px;
    background: #333;
    padding: 15px;
    border-radius: 6px;
    flex-shrink: 0;
    cursor: pointer;
    transition: background 0.3s;
    white-space: nowrap;
  }
  .slide-item:hover {
    background: #ff6600;
  }
  nav {
    margin-top: 10px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  nav button {
    background: #333;
    border: none;
    color: #eee;
    padding: 8px 14px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s;
  }
  nav button.active, nav button:hover {
    background: #ff6600;
  }
  #searchInput {
    margin: 10px 0;
    padding: 8px;
    width: 100%;
    max-width: 400px;
    border-radius: 4px;
    border: none;
    font-size: 16px;
  }
  main {
    padding: 15px;
  }
  .media-card {
    background:#222;
    margin:10px 0;
    border-radius: 6px;
    padding: 10px;
    cursor: pointer;
    display: flex;
    gap: 10px;
    align-items: center;
  }
  .media-card:hover {
    background: #444;
  }
  img.thumb {
    width: 120px; height: 70px;
    object-fit: cover;
    border-radius: 4px;
  }
  .details-view {
    background: #222;
    border-radius: 6px;
    padding: 15px;
  }
  .details-view h2 {
    margin-top: 0;
  }
  .details-iframe {
    width: 100%;
    height: 350px;
    border: none;
    border-radius: 6px;
  }
  .details-links a {
    margin-right: 10px;
    color: #ff6600;
    text-decoration: none;
    font-weight: bold;
  }
  .details-links a:hover {
    text-decoration: underline;
  }
  .back-btn {
    cursor: pointer;
    color: #ff6600;
    font-weight: bold;
    margin-bottom: 15px;
    display: inline-block;
  }
  form#addEditForm {
    background: #222;
    border-radius: 6px;
    padding: 15px;
    margin-bottom: 20px;
  }
  form#addEditForm label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
  }
  form#addEditForm input[type="text"],
  form#addEditForm textarea,
  form#addEditForm select {
    width: 100%;
    padding: 7px;
    margin-top: 5px;
    border-radius: 4px;
    border: none;
    font-size: 15px;
    background: #333;
    color: #eee;
    resize: vertical;
  }
  form#addEditForm textarea {
    min-height: 80px;
  }
  form#addEditForm button {
    margin-top: 15px;
    background: #ff6600;
    border: none;
    color: #fff;
    font-weight: bold;
    padding: 10px 15px;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.3s;
  }
  form#addEditForm button:hover {
    background: #cc5200;
  }
  .actions-btns {
    margin-top: 15px;
  }
  .actions-btns button {
    background: #cc3300;
    border: none;
    color: #fff;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    margin-right: 10px;
    transition: background 0.3s;
  }
  .actions-btns button:hover {
    background: #990000;
  }
</style>
</head>
<body>

<header>
  <div class="slider" id="titleSlider" aria-label="سلايدر عناوين العناصر"></div>
  <nav id="categoryNav" aria-label="قائمة تصنيفات الأفلام والمسلسلات والأنمي"></nav>
  <input type="search" id="searchInput" placeholder="ابحث هنا ..." aria-label="بحث" />
</header>

<main id="mainContent" tabindex="0">
  <!-- المحتوى الديناميكي -->
</main>

<script>
(() => {
  const OWNER_PASSWORD = 'secret123'; // كلمة السر للتمكين من الإضافة والتعديل والحذف
  let mediaItems = JSON.parse(localStorage.getItem('mediaItems')) || [];

  // التصنيفات
  const categories = [
    { id: 'all', name: 'الكل' },
    { id: 'movie', name: 'أفلام' },
    { id: 'series', name: 'مسلسلات' },
    { id: 'anime', name: 'أنمي' },
    { id: 'action', name: 'أكشن' },
    { id: 'crime', name: 'جريمة' },
    { id: 'surreal', name: 'سيريالي' },
    { id: 'drama', name: 'دراما' },
    { id: 'comedy', name: 'كوميدي' },
    { id: 'sci-fi', name: 'خيال علمي' },
    { id: 'romance', name: 'رومانس' },
    { id: 'documentary', name: 'وثائقي' }
  ];

  let currentCategory = 'all';
  let filteredItems = [];
  let editingIndex = null; // لتعديل مقال محدد

  const mainContent = document.getElementById('mainContent');
  const categoryNav = document.getElementById('categoryNav');
  const titleSlider = document.getElementById('titleSlider');
  const searchInput = document.getElementById('searchInput');

  // إنشاء أزرار التصنيفات
  function renderCategoryButtons() {
    categoryNav.innerHTML = '';
    categories.forEach(cat => {
      const btn = document.createElement('button');
      btn.textContent = cat.name;
      btn.dataset.cat = cat.id;
      if(cat.id === currentCategory) btn.classList.add('active');
      btn.onclick = () => {
        if(currentCategory === cat.id) return;
        currentCategory = cat.id;
        filteredItems = filterByCategory(currentCategory);
        renderMediaCards(filteredItems);
        updateCategoryActive();
      };
      categoryNav.appendChild(btn);
    });
  }
  function updateCategoryActive(){
    Array.from(categoryNav.children).forEach(btn => {
      btn.classList.toggle('active', btn.dataset.cat === currentCategory);
    });
  }

  // فلترة حسب التصنيف
  function filterByCategory(cat) {
    if(cat === 'all') return [...mediaItems];
    return mediaItems.filter(item => item.category === cat);
  }

  // عمل السلايدر للعناوين
  function renderTitleSlider(items) {
    titleSlider.innerHTML = '';
    if(!items.length) {
      titleSlider.textContent = 'مافي عناصر للعرض.';
      return;
    }
    items.forEach((item, idx) => {
      const div = document.createElement('div');
      div.className = 'slide-item';
      div.textContent = item.title;
      div.title = item.title;
      div.tabIndex = 0;
      div.onclick = () => showDetails(idx);
      div.onkeydown = (e) => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          showDetails(idx);
        }
      };
      titleSlider.appendChild(div);
    });
  }

  // عرض العناصر ككروت
  function renderMediaCards(items) {
    if(items.length === 0){
      mainContent.innerHTML = `
      <p>مافي عناصر تتناسب مع البحث أو الفلتر.</p>
      <button id="btnAddNew" style="margin-top:15px;padding:10px 15px;background:#ff6600;border:none;border-radius:4px;cursor:pointer;color:#fff;font-weight:bold;">إضافة مقال جديد</button>
      `;
      document.getElementById('btnAddNew').onclick = () => showAddEditForm();
      renderTitleSlider([]);
      return;
    }
    mainContent.innerHTML = '';
    const addBtn = document.createElement('button');
    addBtn.textContent = 'إضافة مقال جديد';
    addBtn.style = 'background:#ff6600;color:#fff;padding:10px 15px;border:none;border-radius:4px;cursor:pointer;font-weight:bold;margin-bottom:15px;';
    addBtn.onclick = () => showAddEditForm();
    mainContent.appendChild(addBtn);

    items.forEach((item, idx) => {
      const card = document.createElement('div');
      card.className = 'media-card';
      card.tabIndex = 0;

      card.onclick = () => showDetails(idx);
      card.onkeydown = (e) => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          showDetails(idx);
        }
      };

      const thumb = document.createElement('img');
      thumb.src = item.thumbnail || 'https://via.placeholder.com/300x140?text=بدون+صورة';
      thumb.alt = item.title;
      thumb.className = 'thumb';

      const info = document.createElement('div');
      info.style.flex = '1';

      const title = document.createElement('h3');
      title.textContent = item.title;

      const desc = document.createElement('p');
      desc.textContent = item.description;

      info.appendChild(title);
      info.appendChild(desc);

      card.appendChild(thumb);
      card.appendChild(info);

      mainContent.appendChild(card);
    });

    renderTitleSlider(items);
  }

  // عرض تفاصيل عنصر + أزرار تعديل وحذف
  function showDetails(id) {
    const item = filteredItems[id];
    if(!item) {
      alert("هذا العنصر ما موجود.");
      return;
    }
    mainContent.innerHTML = `
      <span class="back-btn" tabindex="0" role="button" aria-label="العودة للقائمة">← رجوع</span>
      <div class="details-view">
        <h2>${item.title}</h2>
        <p><strong>الوصف:</strong> ${item.description}</p>
        <p><strong>القصة:</strong><br>${item.story ? item.story.replace(/\n/g, '<br>') : 'مافي قصة مضافة'}</p>
        <p><strong>التصنيف:</strong> ${categories.find(c => c.id === item.category)?.name || item.category}</p>
        <iframe class="details-iframe" src="${item.embedLink}" allowfullscreen allow="autoplay; fullscreen"></iframe>
        <div class="details-links" style="margin-top:10px;">
          ${item.downloadLinks.map((dl, i) => `<a href="${dl}" target="_blank" rel="noopener noreferrer">تحميل ${i+1}</a>`).join('')}
        </div>
        <div class="actions-btns">
          <button id="editBtn">تعديل</button>
          <button id="deleteBtn">حذف</button>
        </div>
      </div>
    `;
    const backBtn = mainContent.querySelector('.back-btn');
    backBtn.onclick = () => renderMediaCards(filteredItems);
    backBtn.onkeydown = (e) => {
      if(e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        backBtn.click();
      }
    };

    document.getElementById('editBtn').onclick = () => showAddEditForm(id);
    document.getElementById('deleteBtn').onclick = () => {
      if(confirm(`هل تبي تحذف المقال "${item.title}"؟ ما يمديك ترجعه بعدين.`)){
        mediaItems.splice(mediaItems.indexOf(item), 1);
        saveAndRefresh();
      }
    };
  }

  // حفظ التغييرات لل localStorage وتحديث العرض
  function saveAndRefresh(){
    localStorage.setItem('mediaItems', JSON.stringify(mediaItems));
    filteredItems = filterByCategory(currentCategory);
    renderMediaCards(filteredItems);
  }

  // نموذج الإضافة والتعديل
  function showAddEditForm(editId = null) {
    // طلب كلمة السر قبل التعديل أو الإضافة
    let pass = prompt('ادخل كلمة السر للدخول على الإضافة/التعديل:');
    if(pass !== OWNER_PASSWORD){
      alert('كلمة السر خاطئة! ما تقدر تضيف أو تعدل.');
      return;
    }

    editingIndex = (editId !== null) ? editId : null;
    let item = editingIndex !== null ? filteredItems[editingIndex] : {
      title: '',
      description: '',
      story: '',
      thumbnail: '',
      embedLink: '',
      downloadLinks: [''],
      category: 'movie'
    };

    mainContent.innerHTML = `
      <span class="back-btn" tabindex="0" role="button" aria-label="العودة للقائمة">← رجوع</span>
      <form id="addEditForm" aria-label="${editingIndex !== null ? 'نموذج تعديل المقال' : 'نموذج إضافة مقال جديد'}">
        <label for="titleInput">العنوان:</label>
        <input type="text" id="titleInput" name="title" required value="${escapeHtml(item.title)}" />

        <label for="descInput">الوصف القصير:</label>
        <textarea id="descInput" name="description" required>${escapeHtml(item.description)}</textarea>

        <label for="storyInput">القصة (ممكن تضيف تفاصيل أكثر هنا):</label>
        <textarea id="storyInput" name="story">${escapeHtml(item.story)}</textarea>

        <label for="thumbnailInput">رابط صورة الغلاف:</label>
        <input type="text" id="thumbnailInput" name="thumbnail" value="${escapeHtml(item.thumbnail)}" />

        <label for="embedInput">رابط الفيديو (iframe src):</label>
        <input type="text" id="embedInput" name="embedLink" value="${escapeHtml(item.embedLink)}" />

        <label for="downloadsInput">روابط التحميل (افصل بينها بفواصل):</label>
        <input type="text" id="downloadsInput" name="downloadLinks" value="${item.downloadLinks.join(',')}" />

        <label for="categorySelect">التصنيف:</label>
        <select id="categorySelect" name="category" required>
          ${categories.filter(c => c.id !== 'all').map(c =>
            `<option value="${c.id}" ${item.category === c.id ? 'selected' : ''}>${c.name}</option>`
          ).join('')}
        </select>

        <button type="submit">${editingIndex !== null ? 'حفظ التعديلات' : 'إضافة المقال'}</button>
      </form>
    `;

    const backBtn = mainContent.querySelector('.back-btn');
    backBtn.onclick = () => renderMediaCards(filteredItems);
    backBtn.onkeydown = (e) => {
      if(e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        backBtn.click();
      }
    };

    const form = document.getElementById('addEditForm');
    form.onsubmit = e => {
      e.preventDefault();
      const formData = new FormData(form);
      const newItem = {
        title: formData.get('title').trim(),
        description: formData.get('description').trim(),
        story: formData.get('story').trim(),
        thumbnail: formData.get('thumbnail').trim(),
        embedLink: formData.get('embedLink').trim(),
        downloadLinks: formData.get('downloadLinks').split(',').map(d => d.trim()).filter(d => d),
        category: formData.get('category')
      };
      if(!newItem.title || !newItem.description || !newItem.category){
        alert('لازم تعبي العنوان والوصف والتصنيف.');
        return;
      }
      if(editingIndex !== null){
        // تعديل
        const globalIndex = mediaItems.indexOf(filteredItems[editingIndex]);
        if(globalIndex > -1){
          mediaItems[globalIndex] = newItem;
        }
      } else {
        // إضافة جديد
        mediaItems.push(newItem);
      }
      saveAndRefresh();
    };
  }

  // هروب من XSS بسيط
  function escapeHtml(text) {
    if(!text) return '';
    return text.replace(/[&<>"']/g, function(m) {
      return ({
        '&':'&amp;',
        '<':'&lt;',
        '>':'&gt;',
        '"':'&quot;',
        "'":'&#39;'
      })[m];
    });
  }

  // البحث
  searchInput.oninput = () => {
    const term = searchInput.value.trim().toLowerCase();
    if(!term) {
      filteredItems = filterByCategory(currentCategory);
    } else {
      filteredItems = filterByCategory(currentCategory).filter(item => 
        item.title.toLowerCase().includes(term) ||
        item.description.toLowerCase().includes(term) ||
        (item.story && item.story.toLowerCase().includes(term))
      );
    }
    renderMediaCards(filteredItems);
  };

  // بدء البرنامج

  if(mediaItems.length === 0){
    // مثال جاهز واحد يشتغل
    mediaItems.push({
      title: "فيلم الأكشن الأول",
      description: "فيلم أكشن رهيب مع قصص مشوقة.",
      story: "هذه قصة الفيلم بكل تفاصيله الرهيبة...",
      thumbnail: "https://via.placeholder.com/300x140?text=فيلم+أكشن",
      embedLink: "https://www.youtube.com/embed/tgbNymZ7vqY",
      downloadLinks: ["https://example.com/download1"],
      category: "action"
    });
    localStorage.setItem('mediaItems', JSON.stringify(mediaItems));
  }

  currentCategory = 'all';
  filteredItems = filterByCategory(currentCategory);
  renderCategoryButtons();
  renderMediaCards(filteredItems);

})();
</script>

</body>
</html>
